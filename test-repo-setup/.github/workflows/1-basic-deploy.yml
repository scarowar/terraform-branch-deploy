# Basic Deployment - Simple one-step workflow
#
# Usage: Comment ".plan to dev" or ".apply to prod" on any PR
# This is the simplest pattern - everything in one action call.

name: "1ï¸âƒ£ Basic Deploy"

on:
  issue_comment:
    types: [created]

permissions:
  pull-requests: write
  deployments: write
  contents: write
  checks: read
  statuses: read

concurrency:
  group: terraform-basic-${{ github.event.issue.number }}
  cancel-in-progress: false

jobs:
  deploy:
    if: github.event.issue.pull_request
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # One step does everything: parse command + run terraform
      - name: Terraform Branch Deploy
        id: deploy
        uses: scarowar/terraform-branch-deploy@refactor/core
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          # mode: dispatch (default) - calls branch-deploy + runs terraform
          dry-run: "true"  # Set to "false" for real terraform

      - name: Summary
        if: steps.deploy.outputs.continue == 'true'
        run: |
          echo "## ðŸš€ Deployment Complete" >> $GITHUB_STEP_SUMMARY
          echo "| Setting | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| Environment | ${{ steps.deploy.outputs.environment }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Operation | ${{ steps.deploy.outputs.noop == 'true' && 'plan' || 'apply' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| SHA | ${{ steps.deploy.outputs.sha }} |" >> $GITHUB_STEP_SUMMARY
